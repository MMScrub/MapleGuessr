<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>MapleGuessr v0.2.2 (Early Access)</title>
<style>
/* ===== UI & Layout Styling ===== */
  
body { font-family: Arial, sans-serif; background: #1a1a1a; color: #f0f0f0; text-align: center; padding: 20px; }
h1 { cursor: pointer; color: #6d88ff; }
.menu { display: flex; flex-direction: column; align-items: center; gap: 15px; margin-top: 50px; }
.menu button { padding: 14px 20px; font-size: 18px; border: none; border-radius: 8px; cursor: pointer; width: 200px; background-color: #444; color: white; }
.menu button:hover { background-color: #666; }
.wip { font-size: 12px; color: #aaa; margin-top: 4px; }
.game-container { display: none; max-width: 900px; margin: auto; }
input { padding: 8px; width: 220px; margin-top: 10px; border-radius: 6px; border: none; }
button#submit-btn { padding: 8px 14px; margin-left: 5px; cursor: pointer; background: #6d88ff; border: none; border-radius: 6px; color: white; }
table { width: 100%; border-collapse: collapse; margin-top: 15px; }
th, td { padding: 8px; border: 1px solid #555; }
th { background: #333; }
.green { background-color: #2e7d32; }
.yellow { background-color: #f9a825; }
.red { background-color: #c62828; }
.answer-row { font-weight: bold; outline: 2px solid #6dff6d; }
#suggestions { list-style: none; background: #2a2a2a; padding: 0; margin: 0 auto; width: 240px; border-radius: 4px; text-align: left; }
#suggestions li { padding: 6px; cursor: pointer; }
#suggestions li:hover { background-color: #444; }
/* Collapsible How to Play */
.howto { margin-top: 20px; text-align: left; background: #2a2a2a; border-radius: 6px; overflow: hidden; }
.howto-header { padding: 10px; cursor: pointer; font-weight: bold; background: #333; }
.howto-content { display: none; padding: 10px; font-size: 14px; }
.badge { display: inline-block; padding: 2px 6px; border-radius: 4px; font-size: 12px; margin-right: 6px; background:#444; }
</style>
</head>
<body>

<h1 id="title">MapleGuessr</h1>

<!-- Main Menu -->
<div id="menu" class="menu">
  <div><button id="play-items">Items</button></div>
  <div><button disabled>NPCs</button><div class="wip">(WIP)</div></div>
  <div><button disabled>Bosses</button><div class="wip">(WIP)</div></div>
</div>

<!-- Game Screen -->
<div id="game" class="game-container">
  <h2 id="game-title">Items</h2>
  <input type="text" id="guess-input" placeholder="Enter your guess..." autocomplete="off" />
  <ul id="suggestions"></ul>
  <button id="submit-btn">Submit</button>

  <table id="guess-table">
    <thead>
      <tr>
        <th>Item</th>
        <th>Equip Level</th>
        <th>Stackable</th>
        <th>Class Type</th>
        <th>Tradable</th>
        <th>Dropped By / Source</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>

  <p id="result"></p>

  <!-- How to Play (Collapsible) -->
  <div class="howto">
    <div class="howto-header" id="howto-toggle">How to Play +</div>
    <div class="howto-content" id="howto-content">
      <p><strong>Goal:</strong> Guess the hidden MapleLegends item of the day.</p>
      <p><strong>Colors:</strong></p>
      <ul>
        <li>üü© Green = Exact match</li>
        <li>üü® Yellow = Partial match (Equip Level ¬±5, same <em>source type</em> but different specific source)</li>
        <li>üü• Red = No match</li>
      </ul>
      <p><strong>Equip Level:</strong> ‚Üë means the real item requires a higher level, ‚Üì means lower. ‚Äú‚Äî‚Äù for non-equipables.</p>
      <p><strong>Source badges:</strong> We show the source type right in the cell:
        <span class="badge">[Mob]</span>
        <span class="badge">[Gachapon]</span>
        <span class="badge">[PQ]</span>
      </p>
    </div>
  </div>
</div>

<script>
// ===== Items Data (v0.2.2) =====
  
  localStorage.clear(); // TEMP: clear all game data each load for testing
const items = [
  { name: "Zakum Helmet", equipLevel: 50, stackable: false, classType: "Helmet", tradable: false, droppedBy: "Zakum" },
  { name: "Onyx Apple", equipLevel: null, stackable: true, classType: "Consumable", tradable: true, droppedBy: "Amoria PQ" },
  { name: "Chaos Scroll 60%", equipLevel: null, stackable: true, classType: "Scroll", tradable: false, droppedBy: "Gachapon - Kerning" },
  { name: "Facestompers", equipLevel: 50, stackable: false, classType: "Shoes", tradable: true, droppedBy: "Scarlion" },
  { name: "White Scroll", equipLevel: null, stackable: true, classType: "Scroll", tradable: true, droppedBy: "Gachapon - Kerning" },
  { name: "Mark of Naricain", equipLevel: 110, stackable: false, classType: "Pendant", tradable: true, droppedBy: "CWKPQ" },
  { name: "Balanced Fury", equipLevel: null, stackable: true, classType: "Throwing Star", tradable: true, droppedBy: "Gachapon - Perion" },
  { name: "Ravana Helmet", equipLevel: 70, stackable: false, classType: "Helmet", tradable: false, droppedBy: "Ravana" },
  { name: "Crimson Arcglaive", equipLevel: 100, stackable: false, classType: "Spear", tradable: true, droppedBy: "Gachapon - Perion" }
];

// ===== Menu Logic =====
document.getElementById("play-items").addEventListener("click", () => {
  document.getElementById("menu").style.display = "none";
  document.getElementById("game").style.display = "block";
  startGame(items);
});
document.getElementById("title").addEventListener("click", () => {
  document.getElementById("menu").style.display = "flex";
  document.getElementById("game").style.display = "none";
});

// ===== How to Play Toggle =====
document.getElementById("howto-toggle").addEventListener("click", () => {
  const content = document.getElementById("howto-content");
  const toggle = document.getElementById("howto-toggle");
  if (content.style.display === "block") {
    content.style.display = "none";
    toggle.textContent = "How to Play +";
  } else {
    content.style.display = "block";
    toggle.textContent = "How to Play ‚Äì";
  }
});

// ===== Helpers for feedback =====
function getDropType(src) {
  const s = (src || "").toLowerCase();
  if (s.includes("gachapon")) return "gachapon";
  if (s.includes("pq")) return "pq";
  return "mob"; // default: boss/mob
}
function formatSourceWithBadge(src) {
  const t = getDropType(src);
  const label = t === "pq" ? "[PQ]" : t === "gachapon" ? "[Gachapon]" : "[Mob]";
  return `<span class="badge">${label}</span>${src}`;
}
function dropColor(guessDrop, answerDrop) {
  if (guessDrop === answerDrop) return 'green';
  const gType = getDropType(guessDrop);
  const aType = getDropType(answerDrop);
  if (gType === aType) return 'yellow';
  return 'red';
}
function equipLevelColor(guess, correct) {
  if (guess === correct) return 'green';
  if (guess != null && correct != null && Math.abs(guess - correct) <= 5) return 'yellow';
  return 'red';
}
function equipLevelDisplay(guess, correct) {
  if (guess == null) return "‚Äî";
  let arrow = "";
  if (correct != null && guess < correct) arrow = " ‚Üë";
  if (correct != null && guess > correct) arrow = " ‚Üì";
  return guess + arrow;
}

// ===== Game Logic =====
function startGame(pool) {
  const today = new Date().toDateString();
  const todayIndex = new Date().getDate() % pool.length;
  const answer = pool[todayIndex];

  // daily reset for items category
  let guessesData = JSON.parse(localStorage.getItem("guesses_items")) || { date: today, guesses: [] };
  if (guessesData.date !== today) {
    guessesData = { date: today, guesses: [] };
    localStorage.setItem("guesses_items", JSON.stringify(guessesData));
  }

  const guessInput = document.getElementById("guess-input");
  const submitBtn = document.getElementById("submit-btn");
  const tableBody = document.querySelector("#guess-table tbody");
  const result = document.getElementById("result");
  const suggestionBox = document.getElementById("suggestions");

  tableBody.innerHTML = "";
  guessesData.guesses.forEach(g => addGuessToTable(g));

  function addGuessToTable(item) {
    const row = document.createElement("tr");
    if (item.name === answer.name) row.classList.add("answer-row");
    row.innerHTML = `
      <td class="${item.name === answer.name ? 'green' : 'red'}">${item.name}</td>
      <td class="${equipLevelColor(item.equipLevel, answer.equipLevel)}">${equipLevelDisplay(item.equipLevel, answer.equipLevel)}</td>
      <td class="${item.stackable === answer.stackable ? 'green' : 'red'}">${item.stackable ? 'Yes' : 'No'}</td>
      <td class="${item.classType === answer.classType ? 'green' : 'red'}">${item.classType}</td>
      <td class="${item.tradable === answer.tradable ? 'green' : 'red'}">${item.tradable ? 'Yes' : 'No'}</td>
      <td class="${dropColor(item.droppedBy, answer.droppedBy)}">${formatSourceWithBadge(item.droppedBy)}</td>
    `;
    tableBody.appendChild(row);
  }

  // Suggestions
  guessInput.addEventListener("input", () => {
    const val = guessInput.value.trim().toLowerCase();
    suggestionBox.innerHTML = "";
    if (!val) return;
    const matches = pool.filter(e => e.name.toLowerCase().includes(val));
    matches.slice(0, 8).forEach(match => {
      const li = document.createElement("li");
      li.textContent = match.name;
      li.onclick = () => {
        guessInput.value = match.name;
        suggestionBox.innerHTML = "";
      };
      suggestionBox.appendChild(li);
    });
  });

  // Submit Guess
  submitBtn.addEventListener("click", () => {
    const userGuess = guessInput.value.trim().toLowerCase();
    if (!userGuess) return;

    if (guessesData.guesses.find(g => g.name.toLowerCase() === userGuess)) {
      alert("Already guessed that!");
      guessInput.focus();
      return;
    }
    const item = pool.find(i => i.name.toLowerCase() === userGuess);
    if (!item) {
      alert("Item not found in database.");
      guessInput.focus();
      return;
    }

    guessesData.guesses.push(item);
    localStorage.setItem("guesses_items", JSON.stringify(guessesData));
    addGuessToTable(item);

    if (item.name.toLowerCase() === answer.name.toLowerCase()) {
      result.textContent = `üéâ Correct! You got it in ${guessesData.guesses.length} guesses.`;
      result.style.color = "#6dff6d";
    } else {
      result.textContent = "‚ùå Not quite, try again.";
      result.style.color = "#ff7a7a";
    }

    guessInput.value = "";
    suggestionBox.innerHTML = "";
    guessInput.focus();
  });
}
</script>
</body>
</html>

<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>MapleGuessr</title>
<style>

  /* ===== UI & Layout Styling =====
   This section defines the overall appearance for:
   - Page background, fonts, and text colors
   - Menu layout and button styles
   - Game container and input styling
   - Guess table formatting
   - Feedback colors for guesses (green, yellow, red)
   - Suggestions dropdown list
*/
  body { font-family: Arial, sans-serif; background: #1a1a1a; color: #f0f0f0; text-align: center; padding: 20px; }
  h1 { cursor: pointer; color: #6d88ff; }
  .menu { display: flex; flex-direction: column; align-items: center; gap: 15px; margin-top: 50px; }
  .menu button { padding: 14px 20px; font-size: 18px; border: none; border-radius: 8px; cursor: pointer; width: 200px; background-color: #444; color: white; }
  .menu button:hover { background-color: #666; }
  .wip { font-size: 12px; color: #aaa; margin-top: 4px; }
  .game-container { display: none; max-width: 800px; margin: auto; }
  input { padding: 8px; width: 200px; margin-top: 10px; border-radius: 6px; border: none; }
  button#submit-btn { padding: 8px 14px; margin-left: 5px; cursor: pointer; background: #6d88ff; border: none; border-radius: 6px; color: white; }
  table { width: 100%; border-collapse: collapse; margin-top: 15px; }
  th, td { padding: 8px; border: 1px solid #555; }
  th { background: #333; }
  .green { background-color: #2e7d32; }
  .yellow { background-color: #f9a825; }
  .red { background-color: #c62828; }
  #suggestions { list-style: none; background: #2a2a2a; padding: 0; margin: 0 auto; width: 220px; border-radius: 4px; text-align: left; }
  #suggestions li { padding: 6px; cursor: pointer; }
  #suggestions li:hover { background-color: #444; }
</style>
</head>
<body>

<h1 id="title">MapleGuessr</h1>

<!-- Main Menu -->
<div id="menu" class="menu">
  <div>
    <button id="play-items">Items</button>
  </div>
  <div>
    <button disabled>NPCs</button>
    <div class="wip">(WIP)</div>
  </div>
  <div>
    <button disabled>Bosses</button>
    <div class="wip">(WIP)</div>
  </div>
</div>

<!-- Game Screen -->
<div id="game" class="game-container">
  <h2 id="game-title">Items</h2>
  <input type="text" id="guess-input" placeholder="Enter your guess..." autocomplete="off" />
  <ul id="suggestions"></ul>
  <button id="submit-btn">Submit</button>

  <table id="guess-table">
    <thead>
      <tr>
        <th>Item</th>
        <th>Release</th>
        <th>Stackable</th>
        <th>Class Type</th>
        <th>Tradable</th>
        <th>Dropped By</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>

  <p id="result"></p>
</div>

<script>
// ================= TEST DATA =================
const items = [
  { name: "Zakum Helmet", release: "v62", stackable: false, classType: "Helmet", tradable: false, droppedBy: "Zakum" },
  { name: "Onyx Apple", release: "v62", stackable: true, classType: "Consumable", tradable: true, droppedBy: "Crimson Balrog" },
  { name: "Stormcaster Gloves", release: "v62", stackable: false, classType: "Gloves", tradable: true, droppedBy: "Crimsonwood Keep Boss" },
  { name: "Chaos Scroll 60%", release: "v62", stackable: true, classType: "Scroll", tradable: true, droppedBy: "Gachapon - Kerning" }
];

// ================= MENU LOGIC =================
document.getElementById("play-items").addEventListener("click", () => {
  document.getElementById("menu").style.display = "none";
  document.getElementById("game").style.display = "block";
  startGame(items);
});

// Menu button via title
document.getElementById("title").addEventListener("click", () => {
  document.getElementById("menu").style.display = "flex";
  document.getElementById("game").style.display = "none";
});

// ================= GAME FUNCTION =================
function startGame(pool) {
  const today = new Date().toDateString(); // reset daily
  const todayIndex = new Date().getDate() % pool.length;
  const answer = pool[todayIndex];
  let guessesData = JSON.parse(localStorage.getItem("guesses_items")) || { date: today, guesses: [] };

  if (guessesData.date !== today) {
    guessesData = { date: today, guesses: [] };
    localStorage.setItem("guesses_items", JSON.stringify(guessesData));
  }

  const guessInput = document.getElementById("guess-input");
  const submitBtn = document.getElementById("submit-btn");
  const tableBody = document.querySelector("#guess-table tbody");
  const result = document.getElementById("result");
  const suggestionBox = document.getElementById("suggestions");

  tableBody.innerHTML = "";
  guessesData.guesses.forEach(g => addGuessToTable(g));

  function addGuessToTable(item) {
    if (!item) return;
    const row = document.createElement("tr");
    row.innerHTML = `
      <td class="${item.name === answer.name ? 'green' : 'red'}">${item.name}</td>
      <td class="${item.release === answer.release ? 'green' : 'red'}">${item.release}</td>
      <td class="${item.stackable === answer.stackable ? 'green' : 'red'}">${item.stackable ? 'Yes' : 'No'}</td>
      <td class="${item.classType === answer.classType ? 'green' : 'red'}">${item.classType}</td>
      <td class="${item.tradable === answer.tradable ? 'green' : 'red'}">${item.tradable ? 'Yes' : 'No'}</td>
      <td class="${dropColor(item.droppedBy, answer.droppedBy)}">${item.droppedBy}</td>
    `;
    tableBody.appendChild(row);
  }

  function dropColor(guessDrop, answerDrop) {
    if (guessDrop === answerDrop) return 'green';
    const guessIsMob = !guessDrop.toLowerCase().includes("gachapon");
    const answerIsMob = !answerDrop.toLowerCase().includes("gachapon");
    if (guessIsMob && answerIsMob) return 'yellow';
    const guessIsGach = guessDrop.toLowerCase().includes("gachapon");
    const answerIsGach = answerDrop.toLowerCase().includes("gachapon");
    if (guessIsGach && answerIsGach) return 'yellow';
    return 'red';
  }

  guessInput.addEventListener("input", () => {
    const val = guessInput.value.trim().toLowerCase();
    suggestionBox.innerHTML = "";
    if (!val) return;
    const matches = pool.filter(e => e.name.toLowerCase().includes(val));
    matches.slice(0, 8).forEach(match => {
      const li = document.createElement("li");
      li.textContent = match.name;
      li.onclick = () => {
        guessInput.value = match.name;
        suggestionBox.innerHTML = "";
      };
      suggestionBox.appendChild(li);
    });
  });

  submitBtn.addEventListener("click", () => {
    const userGuess = guessInput.value.trim().toLowerCase();
    if (!userGuess) return;
    if (guessesData.guesses.find(g => g.name.toLowerCase() === userGuess)) {
      alert("Already guessed that!");
      return;
    }

    const item = pool.find(i => i.name.toLowerCase() === userGuess);
    if (!item) {
      alert("Item not found in database.");
      return;
    }

    guessesData.guesses.push(item);
    localStorage.setItem("guesses_items", JSON.stringify(guessesData));
    addGuessToTable(item);

    if (item.name.toLowerCase() === answer.name.toLowerCase()) {
      result.textContent = `üéâ Correct! You got it in ${guessesData.guesses.length} guesses.`;
      result.style.color = "#6dff6d";
    } else {
      result.textContent = "‚ùå Not quite, try again.";
      result.style.color = "#ff7a7a";
    }
    guessInput.value = "";
    suggestionBox.innerHTML = "";
  });
}
</script>

</body>
</html>

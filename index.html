<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>MapleGuessr v0.2.3 (Early Access)</title>
<style>
   
/* ===== UI & Layout Styling (v0.2.3 bundled) ===== */
body { font-family: Arial, sans-serif; background: #1a1a1a; color: #f0f0f0; text-align: center; padding: 20px; }
h1 { cursor: pointer; color: #6d88ff; margin-bottom: 8px; }
.dev-row { margin-bottom: 12px; }
.dev-row button { margin: 0 4px 6px 4px; background:#444; color:white; padding:6px 12px; border:none; border-radius:4px; cursor:pointer; }
#reset-btn { background:#aa4444; }
#random-btn { background:#4466aa; }
#daily-btn  { background:#4a7a4a; }
#next-btn   { background:#6d5499; }
#reveal-btn { background:#777; }
.mode-indicator { margin: 8px 0 6px; font-size: 14px; opacity: 0.9; }
.mode-indicator .daily { color:#62d26f; }
.mode-indicator .random { color:#f0c36a; }
.counter { margin: 4px 0 10px; font-size: 14px; opacity: 0.9; }

.menu { display: flex; flex-direction: column; align-items: center; gap: 15px; margin-top: 26px; }
.menu button { padding: 14px 20px; font-size: 18px; border: none; border-radius: 8px; cursor: pointer; width: 200px; background-color: #444; color: white; }
.menu button:hover { background-color: #666; }
.wip { font-size: 12px; color: #aaa; margin-top: 4px; }
.game-container { display: none; max-width: 980px; margin: 0 auto; }

input { padding: 8px; width: 260px; margin-top: 10px; border-radius: 6px; border: none; }
button#submit-btn { padding: 8px 14px; ; margin-left: 5px; margin-top: 2px; cursor: pointer; background: #6d88ff; border: none; border-radius: 6px; color: white; }

table { width: 100%; border-collapse: collapse; margin-top: 15px; }
th, td { padding: 8px; border: 1px solid #555; }
th { background: #333; }
.green { background-color: #2e7d32; }
.yellow { background-color: #f9a825; }
.red { background-color: #c62828; }
.answer-row { font-weight: bold; outline: 2px solid #6dff6d; }

#suggestions { list-style: none; background: #2a2a2a; padding: 0; margin: 0 auto; width: 260px; border-radius: 4px; text-align: left; }
#suggestions li { padding: 6px; cursor: pointer; }
#suggestions li:hover { background-color: #444; }

/* Collapsible How to Play */
.howto { margin-top: 20px; text-align: left; background: #2a2a2a; border-radius: 6px; overflow: hidden; }
.howto-header { padding: 10px; cursor: pointer; font-weight: bold; background: #333; }
.howto-content { display: none; padding: 10px; font-size: 14px; }

/* Source badges */
.badge { display: inline-block; padding: 2px 6px; border-radius: 4px; font-size: 12px; margin-right: 6px; background:#444; }
.badge.pq { background:#2b5fff; }     /* PQ blue */
.badge.gach { background:#7b3fe4; }   /* Gach purple */
.badge.quest { background:#8a5a2b; }  /* Quest brown */
.badge.mob { background:#555; }       /* Mob gray */

/* Name highlight */
.name-partial b { color: #fff; }
</style>
</head>
<body>

<h1 id="title">MapleGuessr</h1>

<!-- Dev tools row -->
<div class="dev-row">
  <button id="reset-btn">Reset Game (Dev)</button>
  <button id="random-btn">Random Answer (Dev)</button>
  <button id="daily-btn">Daily Mode (Dev)</button>
  <button id="next-btn">Next Answer (Dev)</button>
  <button id="reveal-btn">Reveal Answer (Dev)</button>
</div>

<!-- Main Menu -->
<div id="menu" class="menu">
  <div><button id="play-items">Items</button></div>
  <div><button disabled>NPCs</button><div class="wip">(WIP)</div></div>
  <div><button disabled>Bosses</button><div class="wip">(WIP)</div></div>
</div>

<!-- Game Screen -->
<div id="game" class="game-container">
  <h2 id="game-title">Items</h2>

  <div id="mode" class="mode-indicator"></div>
  <div id="guess-counter" class="counter"></div>

  <input type="text" id="guess-input" placeholder="Enter your guess..." autocomplete="off" />
  <ul id="suggestions"></ul>
  <button id="submit-btn">Submit</button>

  <div id="reveal" style="margin-top:8px; font-size:13px; opacity:0.9;"></div>

  <table id="guess-table">
    <thead>
      <tr>
        <th>Item</th>
        <th>Equip Level</th>
        <th>Stackable</th>
        <th>Class Type</th>
        <th>Tradable</th>
        <th>Dropped By / Source</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>

  <p id="result"></p>

  <!-- How to Play (Collapsible) -->
  <div class="howto">
    <div class="howto-header" id="howto-toggle">How to Play +</div>
    <div class="howto-content" id="howto-content">
      <p><strong>Goal:</strong> Guess the hidden MapleLegends item of the day.</p>
      <p><strong>Colors:</strong></p>
      <ul>
        <li>Green = Exact match</li>
        <li>Yellow = Partial match (Equip Level ±5, same source type but different specific source)</li>
        <li>Red = No match</li>
      </ul>
      <p><strong>Equip Level:</strong> ✓ for exact, ↑ means the real item requires a higher level, ↓ means lower. “—” for non-equipables.</p>
      <p><strong>Source badges:</strong> we show the type right in the cell:
        <span class="badge mob">[Mob]</span>
        <span class="badge pq">[PQ]</span>
        <span class="badge gach">[Gachapon]</span>
        <span class="badge quest">[Quest]</span>
        (Quest includes crafting-style quests.)
      </p>
    </div>
  </div>
</div>

<script>
// ===== Items Data (MapleLegends-aligned) =====
const items = [
  { name: "Zakum Helmet",      minLevel: 50,  maxLevel: 50,  stackable: false, classType: "Helmet",        tradable: false, droppedBy: "Zakum" },
  { name: "Onyx Apple",        minLevel: null,maxLevel: null,stackable: true,  classType: "Consumable",    tradable: true,  droppedBy: "Amoria PQ" },
  { name: "Chaos Scroll 60%",  minLevel: null,maxLevel: null,stackable: true,  classType: "Scroll",        tradable: false, droppedBy: "Gachapon" },
  { name: "Facestompers",      minLevel: 150, maxLevel: 150, stackable: false, classType: "Shoes",         tradable: true,  droppedBy: "PinkBean" },
  { name: "White Scroll",      minLevel: null,maxLevel: null,stackable: true,  classType: "Scroll",        tradable: false, droppedBy: "Gachapon" },
  { name: "Mark of Naricain",  minLevel: 110, maxLevel: 110, stackable: false, classType: "Pendant",       tradable: true,  droppedBy: "CWKPQ" },
  { name: "Balanced Fury",     minLevel: 70,  maxLevel: 70,  stackable: true,  classType: "Throwing Star", tradable: true,  droppedBy: "Quest - Crafted" },
  { name: "Ravana Helmet",     minLevel: 50,  maxLevel: 90,  stackable: false, classType: "Helmet",        tradable: false, droppedBy: "Quest - Ravana" },
  { name: "Crimson Arcglaive", minLevel: 100, maxLevel: 100, stackable: false, classType: "Spear",         tradable: true,  droppedBy: "Quest - Exchange" }
];

// ===== Dev Buttons =====
document.getElementById("reset-btn").addEventListener("click", () => {
  localStorage.clear();
  location.reload();
});
document.getElementById("random-btn").addEventListener("click", () => {
  const idx = Math.floor(Math.random() * items.length);
  localStorage.setItem("dev_force_index", String(idx));
  localStorage.setItem("guesses_items", JSON.stringify({date: new Date().toDateString(), guesses: []}));
  location.reload();
});
document.getElementById("daily-btn").addEventListener("click", () => {
  localStorage.removeItem("dev_force_index");
  localStorage.setItem("guesses_items", JSON.stringify({date: new Date().toDateString(), guesses: []}));
  location.reload();
});
document.getElementById("next-btn").addEventListener("click", () => {
  const current = parseInt(localStorage.getItem("dev_force_index") ?? "-1", 10);
  const next = isNaN(current) ? 0 : (current + 1) % items.length;
  localStorage.setItem("dev_force_index", String(next));
  localStorage.setItem("guesses_items", JSON.stringify({date: new Date().toDateString(), guesses: []}));
  location.reload();
});
document.getElementById("reveal-btn").addEventListener("click", () => {
  const ans = getAnswerFromPool(items);
  const r = document.getElementById("reveal");
  r.textContent = `Answer (Dev): ${ans.name}`;
});

// ===== Menu + How-to =====
document.getElementById("play-items").addEventListener("click", () => {
  document.getElementById("menu").style.display = "none";
  document.getElementById("game").style.display = "block";
  startGame(items);
});
document.getElementById("title").addEventListener("click", () => {
  document.getElementById("menu").style.display = "flex";
  document.getElementById("game").style.display = "none";
});
document.getElementById("howto-toggle").addEventListener("click", () => {
  const content = document.getElementById("howto-content");
  const toggle = document.getElementById("howto-toggle");
  if (content.style.display === "block") { content.style.display = "none"; toggle.textContent = "How to Play +"; }
  else { content.style.display = "block"; toggle.textContent = "How to Play –"; }
});

// ===== Answer selection =====
function getAnswerFromPool(pool) {
  const forced = localStorage.getItem("dev_force_index");
  if (forced !== null) {
    const idx = Math.max(0, Math.min(pool.length - 1, parseInt(forced, 10) || 0));
    return pool[idx];
  }
  const todayIndex = new Date().getDate() % pool.length;
  return pool[todayIndex];
}
function isRandomMode() {
  return localStorage.getItem("dev_force_index") !== null;
}

// ===== Helpers for feedback & badges =====
function getDropType(src) {
  const s = (src || "").toLowerCase();
  if (s.includes("gachapon")) return "gachapon";
  if (s.includes("pq"))       return "pq";
  if (s.includes("quest"))    return "quest";
  return "mob"; // mob/boss
}
function formatSourceWithBadge(src) {
  const t = getDropType(src);
  const cls = t === "pq" ? "pq" : t === "gachapon" ? "gach" : t === "quest" ? "quest" : "mob";
  const label = t === "pq" ? "[PQ]" : t === "gachapon" ? "[Gachapon]" : t === "quest" ? "[Quest]" : "[Mob]";
  return `<span class="badge ${cls}">${label}</span>${src}`;
}
function dropColor(guessDrop, answerDrop) {
  if (guessDrop === answerDrop) return 'green';
  const gType = getDropType(guessDrop);
  const aType = getDropType(answerDrop);
  if (gType === aType) return 'yellow'; // same type, different specific source
  return 'red';
}
function bothNull(aMin, aMax, bMin, bMax) {
  return aMin == null && aMax == null && bMin == null && bMax == null;
}
function anyNull(aMin, aMax, bMin, bMax) {
  const aNull = (aMin == null || aMax == null);
  const bNull = (bMin == null || bMax == null);
  return aNull || bNull;
}
function rangesOverlap(gMin, gMax, aMin, aMax) {
  return !(gMax < aMin || aMax < gMin);
}
function rangeGap(gMin, gMax, aMin, aMax) {
  if (rangesOverlap(gMin, gMax, aMin, aMax)) return 0;
  if (gMax < aMin) return aMin - gMax;   // guess below answer
  return gMin - aMax;                     // guess above answer
}

// Color logic: green = overlap; yellow = gap ≤ 5; red = far/no data
function levelColor(gMin, gMax, aMin, aMax) {
  if (bothNull(gMin, gMax, aMin, aMax)) return 'green';
  if (anyNull(gMin, gMax, aMin, aMax))  return 'red';
  if (rangesOverlap(gMin, gMax, aMin, aMax)) return 'green';
  return rangeGap(gMin, gMax, aMin, aMax) <= 5 ? 'yellow' : 'red';
}

// Display: "—" for non-equipables; "min–max" or single; add ✓ / ↑ / ↓
function levelDisplay(gMin, gMax, aMin, aMax) {
  if (gMin == null || gMax == null) return "—";
  const text = (gMin === gMax) ? `${gMax}` : `${gMin}–${gMax}`;
  if (aMin == null || aMax == null) return text; // answer isn't equipable
  if (rangesOverlap(gMin, gMax, aMin, aMax)) return `${text} ✓`;
  if (gMax < aMin) return `${text} ↑`; // need higher
  if (gMin > aMax) return `${text} ↓`; // need lower
  return text; // (shouldn't reach if we covered overlap)
}
   
function equipLevelDisplay(guess, correct) {
  if (guess == null) return "—";
  if (correct == null) return String(guess); // if answer not equipable, no arrow
  if (guess === correct) return `${guess} ✓`;
  return guess + (guess < correct ? " ↑" : " ↓");
}
   
// Bold shared words between guess name and answer name
function highlightName(guessName, answerName) {
  const g = guessName.split(/\s+/).map(s => s.toLowerCase());
  const aSet = new Set(answerName.split(/\s+/).map(s => s.toLowerCase()));
  return guessName.split(/\s+/).map(w => aSet.has(w.toLowerCase()) ? `<b>${w}</b>` : w).join(' ');
}

// ===== Game Logic =====
function startGame(pool) {
  const modeEl = document.getElementById("mode");
  modeEl.innerHTML = isRandomMode()
    ? `Mode: <span class="random">Random (Dev)</span>`
    : `Mode: <span class="daily">Daily</span>`;

  const answer = getAnswerFromPool(pool);
  const today = new Date().toDateString();

  // daily-ish structure; guesses stored per day
  let guessesData = JSON.parse(localStorage.getItem("guesses_items")) || { date: today, guesses: [] };
  if (guessesData.date !== today && !isRandomMode()) {
    guessesData = { date: today, guesses: [] };
    localStorage.setItem("guesses_items", JSON.stringify(guessesData));
  }

  const guessInput = document.getElementById("guess-input");
  const submitBtn = document.getElementById("submit-btn");
  const tableBody = document.querySelector("#guess-table tbody");
  const result = document.getElementById("result");
  const suggestionBox = document.getElementById("suggestions");
  const counterEl = document.getElementById("guess-counter");

  tableBody.innerHTML = "";
  updateCounter();
  guessInput.focus();

  // render prior guesses
  guessesData.guesses.forEach(g => addGuessToTable(g));

  function updateCounter() {
    counterEl.textContent = `Guess #${(guessesData.guesses?.length || 0) + 1}`;
  }

  function addGuessToTable(item) {
    const row = document.createElement("tr");
    if (item.name === answer.name) row.classList.add("answer-row");
    row.innerHTML = `
      <td class="${item.name === answer.name ? 'green' : 'red'} name-partial">${highlightName(item.name, answer.name)}</td>
      <td class="${levelColor(item.minLevel, item.maxLevel, answer.minLevel, answer.maxLevel)}"> ${levelDisplay(item.minLevel, item.maxLevel, answer.minLevel, answer.maxLevel)}</td>
      <td class="${item.stackable === answer.stackable ? 'green' : 'red'}">${item.stackable ? 'Yes' : 'No'}</td>
      <td class="${item.classType === answer.classType ? 'green' : 'red'}">${item.classType}</td>
      <td class="${item.tradable === answer.tradable ? 'green' : 'red'}">${item.tradable ? 'Yes' : 'No'}</td>
      <td class="${dropColor(item.droppedBy, answer.droppedBy)}">${formatSourceWithBadge(item.droppedBy)}</td>
    `;
    tableBody.appendChild(row);
  }

  // Suggestions
  guessInput.addEventListener("input", () => {
    const val = guessInput.value.trim().toLowerCase();
    suggestionBox.innerHTML = "";
    if (!val) return;
    const matches = pool.filter(e => e.name.toLowerCase().includes(val));
    matches.slice(0, 8).forEach(match => {
      const li = document.createElement("li");
      li.textContent = match.name;
      li.onclick = () => {
        guessInput.value = match.name;
        suggestionBox.innerHTML = "";
      };
      suggestionBox.appendChild(li);
    });
  });

  // Submit Guess
  submitBtn.addEventListener("click", () => {
    const userGuess = guessInput.value.trim().toLowerCase();
    if (!userGuess) return;

    if (guessesData.guesses.find(g => g.name.toLowerCase() === userGuess)) {
      alert("Already guessed that!");
      guessInput.focus();
      return;
    }
    const item = pool.find(i => i.name.toLowerCase() === userGuess);
    if (!item) {
      alert("Item not found in database.");
      guessInput.focus();
      return;
    }

    guessesData.guesses.push(item);
    localStorage.setItem("guesses_items", JSON.stringify(guessesData));
    addGuessToTable(item);

    if (item.name.toLowerCase() === answer.name.toLowerCase()) {
      result.textContent = `🎉 Correct! You got it in ${guessesData.guesses.length} guesses.`;
      result.style.color = "#6dff6d";
    } else {
      result.textContent = "Not quite, try again.";
      result.style.color = "#ff7a7a";
    }

    updateCounter();
    guessInput.value = "";
    suggestionBox.innerHTML = "";
    guessInput.focus();
  });
}
</script>
</body>
</html>
